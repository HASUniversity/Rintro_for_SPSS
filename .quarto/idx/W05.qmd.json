{"title":"Linear models 2: ANOVA's and Posthoc Tests","markdown":{"headingText":"Linear models 2: ANOVA's and Posthoc Tests","containsRefs":false,"markdown":"\nIf the explanatory variable is categorical data, you can still fit a linear model.\nIn that case you are fitting average values for each group.\nIt's called a One-way ANOVA.\nIn contrast to an independent t-test, you can compare more than two groups.\n\nThe hypothesis you test with an ANOVA is if there are any differences between the groups.\nIf you are interested in which group differ from each other, you have to apply an extra test, called a posthoc test.\n\n\n## ANOVA in R\n\nLike linear regression, you use the `lm()` function to fit a the statistical model, and the function `anova()` to test the hypothesis.\nNB: make sure that R interprets the explanatory variable as categorical. \nThe easiest is that you use letters in the group category names.\n\nIn your data map you find the file koeien.xlsx.\nIt is about milking speed (in kg/min) for three different cattle breeds.\n\n\n::: {#exr-milkprod}\n\nMilk production\n\n* Write a script that imports the data set\n* Add code that a) fit the linear model and b) run an ANOVA\n* Check the output and write down, as comment, your conclusions\n\n:::\n\n\n## Posthoc tests\n\nIf you find a significant difference between the groups, you can test which groups are different with a posthoc test.\n\nOver time, many different posthoc tests have been developed, with sometimes subtle differences in assumptions and optimal use. \nTo keep life simple, we stick with three posthoc tests for three different situations:\n\n* If groups sizes are similar, choose **Tukey HSD**\n* If group sizes are not similar, choose **Bonferroni**\n* If you only want to compare the groups with a control group (instead of all possible pairwise comparisons), choose **Dunnet's**\n\nLike the enormous variety of posthoc test, are there also many ways to apply a posthoc test in R.\nThe package **emmeans** has the function `emmeans()` that works for almost all possible statistical situations, therefor it is high recommendend to use this function.\n\nThe function `emmeans()` requires as first argument the output of a statistical model (in our case the output of `lm()`).\nBoth Tukey HSD and Bonferroni make a pairwise comparison for each combination of groups.\nIn the function `emmeans()` you can define that with the argument `specs = pairwise  ~ explvar`, where explvar is the name of the explanatory variable you want to test.\nThe default posthoc test is Tukey HSD. \nIf you want a Bonferroni instead, add the argument adjust = \"bonf\".\n\n\n::: {#exr-posthoctest}\n\nPosthoc test\n\n* Test, with the right test, which cattle breeds differ in milking speed.\n* Look at the output, and make your conclusions. Write them down as comment in your script.\n\n:::\n\n\nThe result of `emmeans()` is build up in two sections:\n\n* The first section (emmeans) show the average effect of each category, with confidence interval. For applied science is maybe more important than the question which groups are significant different! The name for these average effects are the Estimated Marginal Means.\n* The second section (contrasts) show the hypothesis test of each pairwise comparison, the actual posthoc test. Look at the p-value in the last column.\n\n\n### Dunnet's\n\nFor Dunnet's Posthoc test you need to use for *spects* not pairwise, but `trt.vs.ctrl` (treatment versus control): `specs = trt.vs.ctrl ~ explvar`\n\nThe function automatically takes the first category (lowest in alphabet) as control.\nWith the argument `ref=i` you can define which category is the control, with for i the index number of the control category (place all categories in alphabetic orde, a use the position of the control.\n\nIn case the control is the last in the row, you can also use: `specs = tr.vs.ctrlk ~ explvar`.\n\n\n## Practice\n\nThe next excercise is based on research, published in  the *American Society of Animal Science*.\n\nThe  spore element silicium (Si) has a positive influence on the bone quality.\nIn the reserarch they were focused on the question if Si supplements in lactating mares influences the blood si levels in the foals.\nThey tested three doses (A, B and C), with 5 replicates, in total 15 mares:\n\n| dosis   | Si-gehalte ($\\mu$g/l)    |\n| :-----: | :--------------------: |\n|   A     | 129; 137; 129; 134; 139  |\n|   B     | 133; 148; 142; 139; 134  |\n|   C     | 138; 148; 140; 145; 148  |\n\n\n::: {#exr-silicium}\n\nSilicium\n\n* Make an Excel file wit the data\n* Make an R script that imports the data, create an appropriate graph, apply an One-way ANOVA and in applicable the right Posthoc test.\n* write down you conclusions as comment in the script.\n\n:::\n\n## Two-way ANOVA's\n\nUp to now we have only focussed on one explanatory variable.\nBut often your experiment is more complex.\nE.g. you are testing the growth effect of a new fertilizer on tomato's, and are you testing it on three different tomato varieties.\nNow you have two factors that could influence the growth of the plants: fertilizer and variety.\n\nLuckily we can add both them easily in a linear model: `growth ~ fertilizer + variety`.\n\n\n::: {#exr-twoway}\n\nTwo-way anova\n\n* Write code that import the dataset plantengroei.xlsx from your data map.\n* Make an approriate graph.\n* Test if fertilizer and/or plant variaty has an effect on growth rate.\n* Write down your conclusions as a comment.\n\n:::\n\n\n## Main and  interaction effects\n\nIn the previous example we have used a `+` to add an extra explanatory effects.\nThat plus means that the next variable has an effect, independend from the previous one.\nIn this case you are testing the **main** effects of each variable.\nIf you also want to include possible **interaction** effects you need to use a `*`.\n\n\n## Posthoc tests for two-way ANOVAs\n\nThe function `emmeans()` can be used for two-way ANOVAs as well.\nYou can either test for one of the explanatory variables or all combinations of both.\nIn that case you write `specs = pairwise ~ var1:var2`, with for var1 and var2 both explanatory variables.\n\n\n## Practice\n\nR contains data sets to practice. \nOne of them is about the effect of vitamin C on tooth growth in *Cavia porcellus*.\nWith the function `data(\"ToothGrowth)` you create an object of that dataset.\n\nThe vitamin was applied in three doses (0.5, 1 and 2 mg/day) (*dose*) in two different types of supplement (orange juice or vitamin C extrat) (*supp*).\nThe length of the odontoplasts (growth cells in the teeth) were measured.\n\n::: {#exr-toothgrowth}\n\nTooth growth\n\n* make an object of the data set ToothGrowth\n* check the structure of the data set\n\n:::\n\nAs you can see, the column dose has numerical values.\nIf you are going to put that column as explanatory variable in an `lm()` function, the function will treat it as covariate (meaning as a linear regression).\nThe solution is to make R clear that it is a categorical data.\nThe function for that is `factor()`: \n\n```{r}\nToothGrowth$dose <- factor(ToothGrowth$dose)\n```\n\n::: {#exr-toothgrowth2}\n\nTooth growth, part 2\n\n* apply above function\n* make an clear figure with ggplot\n* Test both for dose and supp, including interaction for significant effects\n* apply an appropriate posthoc test)\n\n\n:::\n\n\n::: {.callout-tip}: \n\nwith the `table(TootGrowth$dose, TootGrowth$supp)`you can get an overview of the number of replicates.\n\n:::\n\n\nYou'll find in your data map the file bemestingxx.xlsx (x replaced by a number).\nIt is about an fertilization experiment with two factors:\n\n* fertilized/not fertilized\n* Extra nutrient added/not added (either K/Mg or Ca)\n\n\n::: {#exr-fertilization2}\n\nFertilization2\n\n\n* imports  the data set\n* makes a clear figure\n* Write down the hypotheses (only main effects, no interactions)\n* apply a two-way ANOVA\n\n:::\n\n\n\n"},"formats":{"html":{"execute":{"fig-width":7,"fig-height":5,"fig-format":"retina","fig-dpi":96,"df-print":"default","error":false,"eval":true,"cache":null,"freeze":false,"echo":true,"output":true,"warning":true,"include":true,"keep-md":false,"keep-ipynb":false,"ipynb":null,"enabled":null,"daemon":null,"daemon-restart":false,"debug":false,"ipynb-filters":[],"engine":"knitr"},"render":{"keep-tex":false,"keep-yaml":false,"keep-source":false,"keep-hidden":false,"prefer-html":false,"output-divs":true,"output-ext":"html","fig-align":"default","fig-pos":null,"fig-env":null,"code-fold":"none","code-overflow":"scroll","code-link":false,"code-line-numbers":false,"code-tools":false,"tbl-colwidths":"auto","merge-includes":true,"latex-auto-mk":true,"latex-auto-install":true,"latex-clean":true,"latex-max-runs":10,"latex-makeindex":"makeindex","latex-makeindex-opts":[],"latex-tlmgr-opts":[],"latex-input-paths":[],"latex-output-dir":null,"link-external-icon":false,"link-external-newwindow":true,"self-contained-math":false,"format-resources":[]},"pandoc":{"standalone":true,"wrap":"none","default-image-extension":"png","to":"html","css":["styles.css"],"output-file":"W05.html"},"language":{},"metadata":{"lang":"en","fig-responsive":true,"quarto-version":"1.0.36","theme":"cosmo"},"extensions":{"book":{"multiFile":true}}}}}