{
  "hash": "6ad0bfffe458e92ccbff80af1cf61fc0",
  "result": {
    "markdown": "# Logistic regression\n\nUp to now you have practiced with hypothese test for numerical continuous data, but in some cases the data behaves differentially.\nA common type of data is binomial: categorical data with only two outcomes.\n\nFor example, a tomato grower is experimenting with the best time to harvest his tomatos:\n\n* On six plants all tomatoes are harvested 10 days before the normal harvest time\n* On four plants all tomatoes are harvested 5 days before the normal harvest time\n* On another six plants all tomatoes are harvested at the normal harvest time\n\nAll harvested tomatoes are labelled ripe or not ripe:\n\n\n::: {.cell}\n::: {.cell-output-display}\n|    | onrijp| rijp|\n|:---|------:|----:|\n|-10 |      5|    1|\n|-5  |      1|    3|\n|0   |      1|    5|\n:::\n:::\n\n\nZulke data kan je mooi presenteren in een mozaiekplot (In het Engels *mosaic plot* geheten):\nThis kind of data can be clearly presented in a mosaic plot (see script for inspiration):\n\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(ggmosaic)\n\ntomaat %>% \n  ggplot() +\n  geom_mosaic(aes(x=product(tijd), fill = rijp)) +\n  scale_fill_manual(values = c(\"green\", \"red\")) +\n  xlab(\"tijd (days before harvest)\") +\n  ylab(\"fraction ripe\") +\n  theme(legend.position = \"none\")\n```\n\n::: {.cell-output-display}\n![](W06_files/figure-html/unnamed-chunk-2-1.png){width=672}\n:::\n:::\n\n\nA nice feature of a mosaic plot is that you can read on both x- and y-axis which fraction is found in each category.\n\n::: {#exr-ggmosaic}\n\nmosaic plots\n\n* install the package ggmosaic\n* Import the data set tomaten.xlsx\n* Make a mosaic plot with above code\n* try to find out what each line of code is doing, writh down comments\n\n:::\n\n## binomial alternative for ANOVA's and linear regressions\n\nThe normal **linear model** cannot handle a binomial respons veriable.\nFor that you need to use a **generalized linear model**.\nThe function in R is `glm()`.\nYou can add your statistical model in the same way as in the function `lm()`, but you have to add an extra argument to make clear that your respons is binomial: `family = binomial()`.\n\n::: {.callout-warning}\n\nThe response variable needs to be either a numerical variable with two values, or a factor (use `factor()`)\n\n:::\n\n> H~0~: all harvest times have the same probability for ripe tomatoes\n\n> H~1~: at least some harvest times differ in probability for ripe tomatoes\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nfit <- glm(factor(rijp)~factor(tijd), family = binomial(), data = tomaat)\n```\n:::\n\n\nNB: the function `factor()` is used for the explanatory variable to make clear to R that the numerica data needs to be treated as categorical data. \n\nThe normal `anova()` function cannot handle the output of `glm()`.\nThe reason is that you cannot apply a normal analysis of variance on these type of models to calculate the p-values.\nInstead you need to use the `Anova()` function from the car package:\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\ncar::Anova(fit)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\nAnalysis of Deviance Table (Type II tests)\n\nResponse: factor(rijp)\n             LR Chisq Df Pr(>Chisq)  \nfactor(tijd)   6.6179  2    0.03655 *\n---\nSignif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1\n```\n:::\n:::\n\n\n\n::: {.callout-warning}\n\nThe package car contains a number of functions with the same name as functions in tidyverse.\nTherefore it is not practical to activate all functions.\nInstead use the code `car::Anova()` to make R clear in which package the function can be found.\n\n:::\n\n::: {#exr-carpackage}\n\ncar package\n\n* Install the car packages\n\n:::\n\n\n## Posthoc test\n\nSimilar as in normal ANOVA's you can apply a posthoc test with the function `emmeans()`\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(emmeans)\nemmeans(fit, specs = pairwise ~ tijd)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n$emmeans\n tijd emmean   SE  df asymp.LCL asymp.UCL\n  -10  -1.61 1.10 Inf    -3.756     0.538\n   -5   1.10 1.15 Inf    -1.165     3.362\n    0   1.61 1.10 Inf    -0.538     3.756\n\nResults are given on the logit (not the response) scale. \nConfidence level used: 0.95 \n\n$contrasts\n contrast             estimate   SE  df z.ratio p.value\n (tijd-10) - (tijd-5)   -2.708 1.59 Inf  -1.701  0.2046\n (tijd-10) - tijd0      -3.219 1.55 Inf  -2.078  0.0945\n (tijd-5) - tijd0       -0.511 1.59 Inf  -0.321  0.9448\n\nResults are given on the log odds ratio (not the response) scale. \nP value adjustment: tukey method for comparing a family of 3 estimates \n```\n:::\n:::\n\n\n\n## Practice\n\nA third year student Applied Biology is doing her internship at a grower and needs to test five different insecticides.\nShe designed the following experiment:\n\n* A certain number of flies is exposed to one of the five insecticides\n* after one hour she counts the number of dead and still alive flies\n\nYou find the data set in your data map: insecticiden.xlsx\n\n::: {#exr-insectices}\n\nInsecticides.\n\n\n* import the data set\n* Make a nice graph\n* apply a logistic regression\n* Test which insecticide kills significant more flies than the control\n\n:::\n\n\n## Regression with binomial data\n\nWe can also present the data in a different way:\n\n\n::: {.cell}\n\n```{.r .cell-code}\ntomaat %>% \n  ggplot(aes(tijd, rijp, color = rijp)) + \n  geom_count() +\n  scale_color_manual(values = c(\"green\", \"red\")) \n```\n\n::: {.cell-output-display}\n![](W06_files/figure-html/unnamed-chunk-6-1.png){width=672}\n:::\n:::\n\n\nWith the function `geom_count()` completely overlapping points are represented with bigger dots.\nAlternative is `geom_jitter()` that randomly move the points a bit to reduce overlap.\n\nNow we have on the x-axis not categories, but a continuous scale.\n\nCan we do something with regression?\nThe answer is yes!\n\nAs with `lm()` the function `glm()` can perform both ANOVAs and regressions.\nThis time the regression is not linear, but logistic: a **logistic regression**.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nfit2 <- glm(factor(rijp) ~ tijd, family = binomial(), data = tomaat)\n```\n:::\n\n\nThe only difference with the previous analysis is that now the variable tijd is NOT a factor.\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\ncar::Anova(fit2)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\nAnalysis of Deviance Table (Type II tests)\n\nResponse: factor(rijp)\n     LR Chisq Df Pr(>Chisq)  \ntijd   5.9506  1    0.01471 *\n---\nSignif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1\n```\n:::\n:::\n\n\n\nFor the tomato grower it is important to know from what time at least 25% of the tomatoes is ripe.\n\nWe can visualise that by adding a trend line (this time `method = glm`) and a horizontal line through 0.25:\n\n\n::: {.cell}\n\n```{.r .cell-code}\ntomaat %>% \n  mutate(rijp = recode(rijp, rijp=1, onrijp=0)) %>%\n  ggplot(aes(tijd, rijp)) + \n  geom_count() +\n  geom_smooth(method=glm, method.args = list(family = binomial())) +\n  ylab(\"Fractie rijp\") +\n  geom_hline(yintercept = 0.25, color = \"blue\", linetype = \"dashed\") +\n  theme(legend.position = \"none\") \n```\n\n::: {.cell-output-display}\n![](W06_files/figure-html/unnamed-chunk-9-1.png){width=672}\n:::\n:::\n\n\nNow you see the typical S-shape of a logistic regression.\nFrom five days before the normal harvest data the fraction ripe tomatoes is above the threshold.\n\n::: {.callout-warning}\n\nWithin ggplot the function `glm()` cannot handle a factor response, but only 0 and 1 values. With the `recode` you can change your text to other values.\n\n:::\n\n::: {#exr-guppies}\n\nGuppies\n\n\nPitkow *et al.* (1960) studied the effect of exposure to low temperature on the survival of guppies.\nHe exposed each time 40 guppies to water at 5Â°C, for 3, 8, 12 or 18 minutes. \n\n* import the data set (guppies.xlsx)\n* make a clear graph, add a trend line\n* apply a logistic regression\n* what are your conclusions\n\n:::\n\n",
    "supporting": [
      "W06_files"
    ],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}